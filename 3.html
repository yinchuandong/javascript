<!DOCTYPE HTML>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>css3 transform</title>
<script src="jquery.js" type="text/javascript"></script>
<style type="text/css">
        .wrap{
            width: 1000px;
            height: 500px;
            position: relative;
        }
        a{
            display: block;
            width: 200px;
            margin: 10px;
            height: 200px;
            float: left;
            position: relative;
        }
        .unit{
            width: 200px;
            height: 200px;
            background:#ffff12;        
        }
        #border{
            border: 1px dashed #555;
            width: 198px;
            height: 198px;
            float: left;
            margin: 10px;
            display: none;
        }
    </style>
</head>

<script type="text/javascript">
$(document).ready(function() {
    var drag1 = new beginDrag();
});
function beginDrag(){
    lastPos = null;
    tag = $('.tag');
    list = [];
    var marginx = 10;
    var marginy = 10;//每个DIV的外边距，宽和高
    width = 200;
    var height = 200;
    pos = new Object();
    storePos();
    for (var i = 0; i < tag.length; i++) {
        (function(i){
            $($('.tag')[i]).mousedown(mouseDown);
        })(i);
    }
}
function storePos(){
        list = [];
    for (var i = 0; i < tag.length; i++) {
            //对象数组，存放每一个tag左上角的位置
            pos = new Object();
            pos.pLeft = $(tag[i]).position().left;
            pos.pTop =  $(tag[i]).position().top;
            pos.pRight = $(tag[i]).position().left+$(tag[i]).width();
            pos.pBottom = $(tag[i]).position().left+$(tag[i]).height();         
            list.push(pos);
        };
}
function mouseDown(){
    storePos();
    dragitem = $(this);
    wrap = $('#wrap');
    border = $('#border');                                              
     $(dragitem).css('left', $(dragitem).position().left);
     $(dragitem).css('top', $(dragitem).position().top);
     $(dragitem).css('position','absolute');   
    //border.insertBefore( $(dragitem) );
    border.css('display','block');
    oEvent = event||ev;
    disX = oEvent.clientX- $(dragitem).position().left;//记录点击鼠标时，鼠标所在的位置离tag左上角的距离
    disY = oEvent.clientY- $(dragitem).position().top;
    $(document).mousemove(mouseMove);
    $(document).mouseup(mouseUp);
    return false;
}
function findPos(x,y){
    var len = list.length;
    for (var i = 0; i < len; i++) {
        if (list[i].pLeft < x && list[i].pRight > x && list[i].pTop < y && list[i].pBottom > y)
            return i;
    }
    return -1;
}
function mouseMove(){
    var oEvent = event||ev;
    var curX =  oEvent.clientX-disX;
    var curY =  oEvent.clientY-disY;//每次移动时算出v的新坐标
     $(dragitem).css('left',curX+'px'); 
     $(dragitem).css('top',curY+'px');//改变坐标
    var x = findPos(oEvent.clientX,oEvent.clientY);
    console.log(x);
    if (lastPos == null || ( lastPos.left > $(dragitem).offset().left || lastPos.top > $(dragitem).offset().top )) {
        border.insertAfter($(tag[x])); 
    }else{
       border.insertBefore($(tag[x]));
    }
    lastPos = $(dragitem).offset();
}
function mouseUp(){
                        var clone = border.clone();
                         $(dragitem).replaceAll(border);
                        border = clone;
                        wrap.append(border);
                        border.css('display','none');
                         $(dragitem).removeAttr("style");
                         $(dragitem).css('position','relative');
                        tag = $('.tag');
                        $(document).unbind('mousemove');
                        $(document).unbind('mouseup');
                        
                    }



    </script>
<body>
<div id="wrap">

<a href="#" class="tag"><div class="unit">1</div></a>
<a href="#" class="tag"><div class="unit">2</div></a>
<a href="#" class="tag"><div class="unit">3</div></a>
<a href="#" class="tag"><div class="unit">4</div></a>
<a href="#" class="tag"><div class="unit">5</div></a>
<a href="#" class="tag"><div class="unit">6</div></a>
<div id="border"></div>
</div>
</body>
</html>
